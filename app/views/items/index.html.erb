<h1>アイテム一覧</h1>

<%= form_with url: items_path, method: :get, local: true do %>
  <label>カテゴリ：</label>
  <%= select_tag :category, options_for_select(['', 'トップス', 'パンツ', 'スカート', 'ワンピース', 'コート', '小物', 'アクセサリー'], params[:category]) %>

  <label>ブランド：</label>
  <%= text_field_tag :brand, params[:brand] %>

  <label>カラー：</label>
  <%= text_field_tag :color, params[:color] %>

  <label>キーワード：</label>
  <%= text_field_tag :keyword, params[:keyword] %>

  <label>値段順：</label>
  <%= select_tag :sort, options_for_select([['', ''], ['安い順', 'price_asc'], ['高い順', 'price_desc']], params[:sort]) %>

  <%= submit_tag '絞り込む' %>
<% end %>


<% filters = [] %>
<% filters << "カテゴリ: #{params[:category]}" if params[:category].present? %>
<% filters << "ブランド: #{params[:brand]}" if params[:brand].present? %>
<% filters << "カラー: #{params[:color]}" if params[:color].present? %>
<% filters << "キーワード: #{params[:keyword]}" if params[:keyword].present? %>
<% filters << "値段: 安い順" if params[:sort] == 'price_asc' %>
<% filters << "値段: 高い順" if params[:sort] == 'price_desc' %>

<% if filters.any? %>
  <p>絞り込み条件：<%= filters.join(" / ") %></p>
<% end %>

<%= link_to '新しいアイテムを登録する', new_item_path, class: 'btn' %>

<table>
  <thead>
    <tr>
      <th>画像</th>
      <th>名前</th>
      <th>ブランド</th>
      <th>カテゴリ</th>
      <th>カラー</th>
      <th>キーワード</th>
      <th>値段</th>
      <th>説明</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @items.each do |item| %>
      <tr>
      <td>
      <% if item.image.attached? %>
        <%= link_to item_path(item) do %>
          <%= image_tag item.image %>
        <% end %>
      <% else %>
        画像なし
      <% end %>
    </td>
        <td><%= item.name %></td>
        <td><%= item.brand %></td>
        <td><%= item.category %></td>
        <td><%= item.color %></td>
        <% keywords = [item.keyword1, item.keyword2].map { |k| k.to_s.strip.downcase }.reject(&:blank?).uniq %>
        <td><%= keywords.any? ? keywords.join(' / ') : 'なし' %></td>
        <td><%= number_to_currency(item.price, unit: "¥") %></td>
        <td><%= item.description %></td>
        <td>
          <%= link_to '編集', edit_item_path(item) %> |
          <%= button_to '削除', item_path(item), method: :delete, onclick: "return confirm('本当に削除しますか？');" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
